<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>sl-gallery test</title>

    <script src="../../../@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../../wct-browser-legacy/browser.js"></script>
  </head>
  <body>

    <test-fixture id="gallery">
      <template>
        <sl-gallery>
          <sl-gallery-image
              src="https://unsplash.it/800/500/?image=257"
              small="https://unsplash.it/400/250/?image=257"
              title="Example Title 01"
          ></sl-gallery-image>
          <sl-gallery-image
              src="https://unsplash.it/800/500/?image=250"
              small="https://unsplash.it/400/250/?image=250"
              title="Another Title 02"
          ></sl-gallery-image>
          <sl-gallery-image
              src="https://unsplash.it/800/500/?image=399"
              small="https://unsplash.it/400/250/?image=399"
              title="Photo Title 03"
              caption="Lorem ipsum dolor sit amet, consectetur adipisicing elit. Necessitatibus tempora ea eius placeat. Sed culpa numquam voluptatibus possimus, eaque vel!"
          ></sl-gallery-image>
          <sl-gallery-image
              src="https://unsplash.it/800/500/?image=146"
              small="https://unsplash.it/400/250/?image=146"
              title="Photo Title 04"
              caption="Necessitatibus tempora ea eius placeat. Sed culpa numquam voluptatibus possimus, eaque vel!"
          ></sl-gallery-image>
        </sl-gallery>
      </template>
    </test-fixture>

    <script type="module">
      import '../sl-gallery.js';

      suite('sl-gallery', () => {

        let gallery;

        setup(() => {
          gallery = fixture('gallery');
        });

        teardown(() => {
          // Reset hash
          window.history.pushState(null, document.title, window.location.pathname + window.location.search);
        });

        test('images is an array with an HTMLElement', (done) => {
          flush(() => {
            assert.isArray(gallery._images, 'gallery._images is an array');
            assert.isTrue(gallery._images[0] instanceof HTMLElement, 'gallery._images contains an HTMLElement');
            done();
          });
        });

        test('image elements are properly observed', (done) => {
          flush(() => {
            const _images = gallery._images;
            assert.equal(gallery.firstElementChild, _images[0]);
            assert.equal(gallery.lastElementChild, _images[_images.length - 1]);
            done();
          });
        });

        test('slideshow hidden on load', () => {
          assert.isTrue(gallery.slideshow.hidden, 'slideshow is hidden');
          assert.isFalse(gallery.slideshow.opened, 'slideshow is not opened');
        });

        test('slideshow opens on hash change', (done) => {
          window.location.hash = '/i/3';
          flush(() => {
            assert.isFalse(gallery.slideshow.hidden, 'slideshow is not hidden');
            assert.isTrue(gallery.slideshow.opened, 'slideshow is opened');
            done();
          });
        });

        test('slideshow opens on image click', (done) => {
          flush(() => {
            gallery.firstElementChild.click();
            flush(() => {
              assert.isFalse(gallery.slideshow.hidden, 'slideshow is not hidden');
              assert.isTrue(gallery.slideshow.opened, 'slideshow is opened');
              done();
            });
          });
        });

        test('slideshow gets focus when opened', (done) => {
          gallery.slideshow.opened = true;
          flush(() => {
            gallery.slideshow === document.activeElement;
            done();
          });
        });

      });
    </script>

  </body>
</html>
